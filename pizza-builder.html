<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üçï PizzaCraft ‚Äî –°–æ–±–µ—Ä–∏ —Å–≤–æ—é –ø–∏—Ü—Ü—É</title>
<link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Nunito:wght@400;600;700;800;900&display=swap" rel="stylesheet">
<style>
  :root {
    --crust: #e8a96a;
    --sauce: #d94f2c;
    --cheese: #f5c842;
    --bg: #fdf6ec;
    --dark: #2d1a0e;
    --card: #fff8ee;
    --accent: #ff6b35;
    --green: #4caf50;
    --shadow: 0 8px 32px rgba(45,26,14,0.13);
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'Nunito', sans-serif;
    background: var(--bg);
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* Floating bg bubbles */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background:
      radial-gradient(circle at 10% 20%, #ffe4c4 0%, transparent 40%),
      radial-gradient(circle at 90% 80%, #ffd1b3 0%, transparent 40%),
      radial-gradient(circle at 50% 50%, #fff3dc 0%, transparent 60%);
    z-index: 0;
    pointer-events: none;
  }

  .container {
    position: relative;
    z-index: 1;
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
  }

  header {
    text-align: center;
    padding: 40px 0 30px;
  }

  header h1 {
    font-family: 'Pacifico', cursive;
    font-size: clamp(2.5rem, 6vw, 4.5rem);
    color: var(--sauce);
    text-shadow: 4px 4px 0 #f5c842, 6px 6px 0 rgba(0,0,0,0.1);
    line-height: 1.1;
  }

  header p {
    font-size: 1.15rem;
    color: #7a5c3a;
    margin-top: 8px;
    font-weight: 600;
  }

  .main-layout {
    display: grid;
    grid-template-columns: 1fr 380px;
    gap: 30px;
    align-items: start;
    margin-top: 20px;
  }

  /* ---- PIZZA CANVAS ---- */
  .pizza-section {
    background: var(--card);
    border-radius: 28px;
    padding: 30px;
    box-shadow: var(--shadow);
    border: 3px solid #ffe5c0;
    text-align: center;
  }

  .pizza-canvas-wrap {
    position: relative;
    width: 340px;
    height: 340px;
    margin: 0 auto 20px;
  }

  .pizza-canvas {
    position: relative;
    width: 340px;
    height: 340px;
    border-radius: 50%;
    overflow: hidden;
  }

  /* Layers */
  .layer {
    position: absolute;
    border-radius: 50%;
    transition: opacity 0.4s, transform 0.4s;
  }

  #crust-layer {
    inset: 0;
    background: radial-gradient(circle at 30% 30%, #f0c580, #c8813a);
    box-shadow: inset 0 0 40px rgba(0,0,0,0.15), inset 0 0 80px rgba(0,0,0,0.1);
  }

  /* Crust ring */
  #crust-ring {
    position: absolute;
    inset: 0;
    border-radius: 50%;
    box-shadow: inset 0 0 0 28px #c8813a;
    pointer-events: none;
    z-index: 2;
  }

  #sauce-layer {
    inset: 28px;
    background: radial-gradient(circle at 35% 30%, #e8553a, #b52d10);
    opacity: 0;
    z-index: 3;
    transition: opacity 0.5s;
  }

  #cheese-layer {
    inset: 30px;
    background: radial-gradient(circle at 40% 35%, #ffe97a, #f0c020);
    opacity: 0;
    z-index: 4;
    transition: opacity 0.5s;
  }

  /* Toppings container */
  #toppings-layer {
    inset: 0;
    z-index: 5;
    pointer-events: none;
  }

  .topping-item {
    position: absolute;
    font-size: 1.6rem;
    animation: popIn 0.3s cubic-bezier(0.34,1.56,0.64,1);
    user-select: none;
    filter: drop-shadow(1px 2px 3px rgba(0,0,0,0.3));
  }

  @keyframes popIn {
    from { transform: scale(0) rotate(-20deg); opacity: 0; }
    to { transform: scale(1) rotate(0deg); opacity: 1; }
  }

  /* Crust size indicator */
  .crust-options {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-bottom: 16px;
    flex-wrap: wrap;
  }

  .crust-btn {
    padding: 8px 18px;
    border-radius: 50px;
    border: 2.5px solid #e8a96a;
    background: white;
    color: #7a5c3a;
    font-family: 'Nunito', sans-serif;
    font-weight: 700;
    font-size: 0.88rem;
    cursor: pointer;
    transition: all 0.2s;
  }

  .crust-btn.active, .crust-btn:hover {
    background: var(--crust);
    color: white;
    border-color: var(--crust);
    transform: translateY(-2px);
  }

  .pizza-name-wrap {
    margin-bottom: 16px;
  }

  .pizza-name-wrap label {
    display: block;
    font-weight: 800;
    color: var(--dark);
    margin-bottom: 6px;
    font-size: 0.95rem;
  }

  .pizza-name-wrap input {
    width: 100%;
    max-width: 300px;
    padding: 10px 16px;
    border-radius: 50px;
    border: 2.5px solid #ffe0b0;
    font-family: 'Nunito', sans-serif;
    font-size: 1rem;
    font-weight: 700;
    color: var(--dark);
    background: white;
    outline: none;
    text-align: center;
    transition: border-color 0.2s;
  }

  .pizza-name-wrap input:focus { border-color: var(--sauce); }

  /* Price tag */
  .price-tag {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    background: linear-gradient(135deg, var(--sauce), #ff8a50);
    color: white;
    padding: 10px 24px;
    border-radius: 50px;
    font-family: 'Pacifico', cursive;
    font-size: 1.4rem;
    box-shadow: 0 4px 16px rgba(217,79,44,0.3);
    margin-bottom: 16px;
  }

  .action-btns {
    display: flex;
    gap: 12px;
    justify-content: center;
    flex-wrap: wrap;
  }

  .btn {
    padding: 12px 24px;
    border-radius: 50px;
    border: none;
    font-family: 'Nunito', sans-serif;
    font-weight: 800;
    font-size: 1rem;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .btn:hover { transform: translateY(-3px); box-shadow: 0 8px 20px rgba(0,0,0,0.15); }
  .btn:active { transform: translateY(0); }

  .btn-order {
    background: linear-gradient(135deg, #4caf50, #2e7d32);
    color: white;
  }

  .btn-reset {
    background: white;
    color: var(--sauce);
    border: 2.5px solid var(--sauce);
  }

  .btn-save {
    background: linear-gradient(135deg, var(--accent), #ff9800);
    color: white;
  }

  /* ---- INGREDIENTS PANEL ---- */
  .ingredients-panel {
    display: flex;
    flex-direction: column;
    gap: 18px;
  }

  .category-card {
    background: var(--card);
    border-radius: 22px;
    padding: 20px;
    box-shadow: var(--shadow);
    border: 3px solid #ffe5c0;
  }

  .category-title {
    font-family: 'Pacifico', cursive;
    font-size: 1.15rem;
    color: var(--sauce);
    margin-bottom: 14px;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .ingredients-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
    gap: 10px;
  }

  .ingredient-btn {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
    padding: 10px 6px;
    border-radius: 16px;
    border: 2.5px solid transparent;
    background: white;
    cursor: pointer;
    transition: all 0.2s;
    position: relative;
    box-shadow: 0 2px 8px rgba(0,0,0,0.06);
  }

  .ingredient-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 16px rgba(0,0,0,0.12);
    border-color: #ffe0b0;
  }

  .ingredient-btn.selected {
    border-color: var(--green);
    background: #f0fff0;
  }

  .ingredient-btn.selected::after {
    content: '‚úì';
    position: absolute;
    top: -6px;
    right: -6px;
    width: 20px;
    height: 20px;
    background: var(--green);
    color: white;
    border-radius: 50%;
    font-size: 0.7rem;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 900;
  }

  .ingredient-btn .emoji { font-size: 1.8rem; }
  .ingredient-btn .name {
    font-size: 0.72rem;
    font-weight: 700;
    color: #5a3e28;
    text-align: center;
    line-height: 1.2;
  }
  .ingredient-btn .price {
    font-size: 0.7rem;
    color: var(--sauce);
    font-weight: 800;
  }

  /* Sauce buttons special */
  .sauce-btn.selected { border-color: var(--sauce); background: #fff0ed; }
  .sauce-btn.selected::after { background: var(--sauce); }

  /* Counter badge on toppings */
  .count-badge {
    position: absolute;
    top: -6px;
    left: -6px;
    width: 22px;
    height: 22px;
    background: var(--accent);
    color: white;
    border-radius: 50%;
    font-size: 0.72rem;
    font-weight: 900;
    display: none;
    align-items: center;
    justify-content: center;
  }

  /* Recipe card */
  .recipe-display {
    background: linear-gradient(135deg, #fff8ee, #fff0d0);
    border-radius: 18px;
    padding: 16px;
    border: 2px dashed #f0c080;
    font-size: 0.9rem;
    color: #5a3e28;
    min-height: 60px;
  }

  .recipe-display .empty {
    color: #b0956d;
    font-style: italic;
    text-align: center;
  }

  .recipe-chip {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    background: white;
    border-radius: 50px;
    padding: 3px 10px;
    margin: 3px;
    font-weight: 700;
    font-size: 0.82rem;
    box-shadow: 0 2px 6px rgba(0,0,0,0.08);
    cursor: pointer;
    transition: all 0.2s;
  }

  .recipe-chip:hover { background: #ffe4e4; }
  .recipe-chip .remove { color: var(--sauce); font-weight: 900; }

  /* ======================== COOKING ANIMATION ======================== */
  .cooking-overlay {
    position: fixed;
    inset: 0;
    background: #1a0a00;
    z-index: 900;
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    overflow: hidden;
  }
  .cooking-overlay.show { display: flex; }

  /* Kitchen background particles */
  .kitchen-bg {
    position: absolute;
    inset: 0;
    pointer-events: none;
    overflow: hidden;
  }
  .spark {
    position: absolute;
    width: 4px;
    height: 4px;
    border-radius: 50%;
    background: #ff9800;
    animation: sparkFloat linear infinite;
    opacity: 0;
  }
  @keyframes sparkFloat {
    0% { transform: translateY(0) scale(1); opacity: 0.8; }
    100% { transform: translateY(-200px) scale(0); opacity: 0; }
  }

  .cooking-title {
    font-family: 'Pacifico', cursive;
    font-size: clamp(1.6rem, 4vw, 2.8rem);
    color: #ff9800;
    text-shadow: 0 0 30px rgba(255,152,0,0.6);
    margin-bottom: 10px;
    position: relative;
    z-index: 2;
    text-align: center;
  }

  .cooking-stage-label {
    font-family: 'Nunito', sans-serif;
    font-size: 1.1rem;
    font-weight: 700;
    color: #ffd580;
    min-height: 32px;
    margin-bottom: 30px;
    position: relative;
    z-index: 2;
    text-align: center;
    transition: opacity 0.3s;
  }

  /* Big pizza on cooking screen */
  .cooking-pizza-wrap {
    position: relative;
    width: 320px;
    height: 320px;
    margin-bottom: 30px;
    z-index: 2;
  }

  .cooking-pizza {
    width: 320px;
    height: 320px;
    border-radius: 50%;
    position: relative;
    overflow: hidden;
    box-shadow: 0 0 60px rgba(255,150,0,0.4), 0 0 120px rgba(255,80,0,0.2);
  }

  .cook-layer {
    position: absolute;
    border-radius: 50%;
    transition: opacity 0.6s ease;
  }

  #cook-crust {
    inset: 0;
    background: radial-gradient(circle at 30% 30%, #f0c580, #c8813a);
    box-shadow: inset 0 0 40px rgba(0,0,0,0.2);
  }
  #cook-crust-ring {
    position: absolute;
    inset: 0;
    border-radius: 50%;
    box-shadow: inset 0 0 0 28px #a86030;
    z-index: 2;
    pointer-events: none;
  }
  #cook-sauce { inset: 28px; z-index: 3; opacity: 0; }
  #cook-cheese { inset: 30px; z-index: 4; opacity: 0; }
  #cook-toppings { inset: 0; z-index: 5; pointer-events: none; }

  /* Ingredient flying in animation */
  .fly-ingredient {
    position: absolute;
    font-size: 3rem;
    z-index: 10;
    pointer-events: none;
    filter: drop-shadow(0 4px 12px rgba(0,0,0,0.5));
    animation: flyIn 0.7s cubic-bezier(0.22,1,0.36,1) forwards;
  }

  @keyframes flyIn {
    0% { transform: scale(2) translateY(-80px) rotate(-30deg); opacity: 0; }
    60% { transform: scale(1.2) translateY(10px) rotate(5deg); opacity: 1; }
    100% { transform: scale(1) translateY(0) rotate(0deg); opacity: 1; }
  }

  /* Splash ripple when ingredient lands */
  .splash {
    position: absolute;
    border-radius: 50%;
    background: rgba(255,200,80,0.35);
    transform: scale(0);
    animation: splashAnim 0.5s ease-out forwards;
    pointer-events: none;
    z-index: 6;
  }
  @keyframes splashAnim {
    0% { transform: scale(0); opacity: 1; }
    100% { transform: scale(3); opacity: 0; }
  }

  /* Oven glow pulse */
  .oven-glow {
    position: absolute;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 400px;
    height: 180px;
    background: radial-gradient(ellipse at center bottom, rgba(255,100,0,0.5) 0%, transparent 70%);
    animation: ovenPulse 1.5s ease-in-out infinite;
    pointer-events: none;
    z-index: 1;
  }
  @keyframes ovenPulse {
    0%, 100% { opacity: 0.6; transform: translateX(-50%) scaleX(1); }
    50% { opacity: 1; transform: translateX(-50%) scaleX(1.15); }
  }

  /* Smoke puffs */
  .smoke {
    position: absolute;
    border-radius: 50%;
    background: rgba(255,200,100,0.15);
    animation: smokePuff 2s ease-out infinite;
    pointer-events: none;
    z-index: 1;
  }
  @keyframes smokePuff {
    0% { transform: translateY(0) scale(0.5); opacity: 0.6; }
    100% { transform: translateY(-120px) scale(2); opacity: 0; }
  }

  /* Progress bar */
  .cook-progress-wrap {
    width: 320px;
    height: 10px;
    background: rgba(255,255,255,0.1);
    border-radius: 50px;
    overflow: hidden;
    position: relative;
    z-index: 2;
    margin-bottom: 20px;
  }
  .cook-progress-bar {
    height: 100%;
    background: linear-gradient(90deg, #ff6b00, #ffcc00);
    border-radius: 50px;
    transition: width 0.5s ease;
    box-shadow: 0 0 12px rgba(255,150,0,0.6);
    width: 0%;
  }

  /* Baking phase */
  .baking-phase {
    display: none;
    flex-direction: column;
    align-items: center;
    position: relative;
    z-index: 2;
  }
  .baking-phase.active { display: flex; }

  .oven-emoji {
    font-size: 6rem;
    animation: ovenShake 0.3s ease-in-out infinite;
    margin-bottom: 16px;
  }
  @keyframes ovenShake {
    0%, 100% { transform: rotate(-2deg); }
    50% { transform: rotate(2deg); }
  }

  .bake-bar-wrap {
    width: 280px;
    height: 24px;
    background: rgba(255,255,255,0.1);
    border-radius: 50px;
    overflow: hidden;
    border: 2px solid rgba(255,150,0,0.4);
  }
  .bake-bar {
    height: 100%;
    background: linear-gradient(90deg, #ff4500, #ff9800, #ffd700);
    border-radius: 50px;
    width: 0%;
    transition: width 0.1s linear;
    box-shadow: 0 0 16px rgba(255,100,0,0.8);
  }

  .bake-text {
    margin-top: 10px;
    font-family: 'Nunito', sans-serif;
    font-weight: 800;
    color: #ffd580;
    font-size: 1rem;
  }

  /* Final reveal */
  .final-reveal {
    display: none;
    flex-direction: column;
    align-items: center;
    position: relative;
    z-index: 2;
    text-align: center;
  }
  .final-reveal.active { display: flex; }

  .final-pizza {
    font-size: 9rem;
    animation: finalBounce 0.6s cubic-bezier(0.34,1.56,0.64,1);
    margin-bottom: 16px;
    filter: drop-shadow(0 8px 24px rgba(255,120,0,0.5));
  }
  @keyframes finalBounce {
    0% { transform: scale(0) rotate(-20deg); }
    100% { transform: scale(1) rotate(0deg); }
  }

  .final-title {
    font-family: 'Pacifico', cursive;
    font-size: 2.2rem;
    color: #ffd700;
    text-shadow: 0 0 20px rgba(255,200,0,0.7);
    margin-bottom: 8px;
  }
  .final-subtitle {
    color: #ffb74d;
    font-weight: 700;
    font-size: 1rem;
    margin-bottom: 24px;
  }
  .confetti-piece {
    position: absolute;
    width: 10px;
    height: 10px;
    border-radius: 2px;
    animation: confettiFall linear forwards;
    pointer-events: none;
  }
  @keyframes confettiFall {
    0% { transform: translateY(-50px) rotate(0deg); opacity: 1; }
    100% { transform: translateY(300px) rotate(720deg); opacity: 0; }
  }

  /* Toast notification */
  .toast {
    position: fixed;
    bottom: 30px;
    left: 50%;
    transform: translateX(-50%) translateY(100px);
    background: var(--dark);
    color: white;
    padding: 14px 28px;
    border-radius: 50px;
    font-family: 'Nunito', sans-serif;
    font-weight: 700;
    font-size: 1rem;
    z-index: 1000;
    transition: transform 0.4s cubic-bezier(0.34,1.56,0.64,1);
    box-shadow: 0 8px 30px rgba(0,0,0,0.3);
    white-space: nowrap;
  }

  .toast.show { transform: translateX(-50%) translateY(0); }

  /* Order modal */
  .modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.5);
    backdrop-filter: blur(4px);
    z-index: 500;
    display: none;
    align-items: center;
    justify-content: center;
  }

  .modal-overlay.show { display: flex; }

  .modal {
    background: var(--card);
    border-radius: 28px;
    padding: 40px 36px;
    max-width: 420px;
    width: 90%;
    text-align: center;
    animation: modalIn 0.4s cubic-bezier(0.34,1.56,0.64,1);
    border: 3px solid #ffe0b0;
    box-shadow: 0 20px 60px rgba(0,0,0,0.2);
  }

  @keyframes modalIn {
    from { transform: scale(0.7); opacity: 0; }
    to { transform: scale(1); opacity: 1; }
  }

  .modal h2 {
    font-family: 'Pacifico', cursive;
    color: var(--sauce);
    font-size: 2rem;
    margin-bottom: 12px;
  }

  .modal p {
    color: #7a5c3a;
    font-size: 1rem;
    margin-bottom: 8px;
    font-weight: 600;
  }

  .modal-pizza-emoji {
    font-size: 5rem;
    animation: spin 2s linear infinite;
    display: block;
    margin: 20px 0;
  }

  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  .modal .btn { margin-top: 20px; }

  /* Responsive */
  @media (max-width: 768px) {
    .main-layout {
      grid-template-columns: 1fr;
    }
    .pizza-canvas-wrap, .pizza-canvas {
      width: 280px;
      height: 280px;
    }
  }
</style>
</head>
<body>

<div class="container">
  <header>
    <h1>üçï PizzaCraft</h1>
    <p>–°–æ–∑–¥–∞–π –ø–∏—Ü—Ü—É —Å–≤–æ–µ–π –º–µ—á—Ç—ã –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å!</p>
  </header>

  <div class="main-layout">

    <!-- PIZZA CANVAS -->
    <div class="pizza-section">
      <div class="pizza-name-wrap">
        <label>–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–≤–æ–µ–π –ø–∏—Ü—Ü—ã</label>
        <input type="text" id="pizza-name" placeholder="–ú–æ—è —à–µ–¥–µ–≤—Ä–∞–ª—å–Ω–∞—è –ø–∏—Ü—Ü–∞..." maxlength="40">
      </div>

      <div class="crust-options">
        <button class="crust-btn active" onclick="setCrust('—Ç–æ–Ω–∫–æ–µ', this)">ü´ì –¢–æ–Ω–∫–æ–µ</button>
        <button class="crust-btn" onclick="setCrust('–∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–µ', this)">üçï –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–µ</button>
        <button class="crust-btn" onclick="setCrust('—Ç–æ–ª—Å—Ç–æ–µ', this)">üßÅ –¢–æ–ª—Å—Ç–æ–µ</button>
      </div>

      <div class="pizza-canvas-wrap">
        <div class="pizza-canvas" id="pizza-canvas">
          <div class="layer" id="crust-layer"></div>
          <div id="crust-ring"></div>
          <div class="layer" id="sauce-layer"></div>
          <div class="layer" id="cheese-layer"></div>
          <div class="layer" id="toppings-layer"></div>
        </div>
      </div>

      <div class="price-tag">
        üí∞ <span id="total-price">149</span> ‚ÇΩ
      </div>

      <div class="action-btns">
        <button class="btn btn-order" onclick="orderPizza()">üõí –ó–∞–∫–∞–∑–∞—Ç—å!</button>
        <button class="btn btn-reset" onclick="resetPizza()">üîÑ –°–±—Ä–æ—Å–∏—Ç—å</button>
        <button class="btn btn-save" onclick="savePizza()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      </div>
    </div>

    <!-- INGREDIENTS PANEL -->
    <div class="ingredients-panel">

      <!-- Sauce -->
      <div class="category-card">
        <div class="category-title">ü´ô –°–æ—É—Å</div>
        <div class="ingredients-grid" id="sauce-grid"></div>
      </div>

      <!-- Cheese -->
      <div class="category-card">
        <div class="category-title">üßÄ –°—ã—Ä</div>
        <div class="ingredients-grid" id="cheese-grid"></div>
      </div>

      <!-- Meat -->
      <div class="category-card">
        <div class="category-title">ü•© –ú—è—Å–æ</div>
        <div class="ingredients-grid" id="meat-grid"></div>
      </div>

      <!-- Veggies -->
      <div class="category-card">
        <div class="category-title">ü•¶ –û–≤–æ—â–∏</div>
        <div class="ingredients-grid" id="veggie-grid"></div>
      </div>

      <!-- Extra -->
      <div class="category-card">
        <div class="category-title">‚ú® –û—Å–æ–±–æ–µ</div>
        <div class="ingredients-grid" id="extra-grid"></div>
      </div>

      <!-- Recipe summary -->
      <div class="category-card">
        <div class="category-title">üìã –°–æ—Å—Ç–∞–≤</div>
        <div class="recipe-display" id="recipe-display">
          <span class="empty">–î–æ–±–∞–≤–ª—è–π –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã, —á—Ç–æ–±—ã —Å–æ–±—Ä–∞—Ç—å –ø–∏—Ü—Ü—É!</span>
        </div>
      </div>

    </div>
  </div>
</div>

<!-- COOKING ANIMATION OVERLAY -->
<div class="cooking-overlay" id="cooking-overlay">
  <div class="kitchen-bg" id="kitchen-bg"></div>
  <div class="oven-glow"></div>
  <div class="smoke" style="width:60px;height:60px;left:20%;bottom:30%;animation-delay:0s;animation-duration:2.2s;"></div>
  <div class="smoke" style="width:40px;height:40px;left:70%;bottom:25%;animation-delay:0.7s;animation-duration:1.8s;"></div>
  <div class="smoke" style="width:80px;height:80px;left:45%;bottom:20%;animation-delay:1.2s;animation-duration:2.5s;"></div>

  <div class="cooking-title" id="cooking-title">üë®‚Äçüç≥ –ì–æ—Ç–æ–≤–∏–º —Ç–≤–æ—é –ø–∏—Ü—Ü—É!</div>
  <div class="cooking-stage-label" id="stage-label">–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤...</div>

  <div id="assembly-phase">
    <div class="cooking-pizza-wrap" style="position:relative;width:320px;height:320px;margin-bottom:30px;z-index:2;">
      <div class="cooking-pizza" id="cook-pizza">
        <div class="cook-layer" id="cook-crust"></div>
        <div id="cook-crust-ring"></div>
        <div class="cook-layer" id="cook-sauce"></div>
        <div class="cook-layer" id="cook-cheese"></div>
        <div id="cook-toppings"></div>
      </div>
    </div>
    <div class="cook-progress-wrap">
      <div class="cook-progress-bar" id="cook-progress"></div>
    </div>
  </div>

  <div class="baking-phase" id="baking-phase">
    <div class="oven-emoji">üî•</div>
    <div style="font-family:'Pacifico',cursive;color:#ff9800;font-size:1.6rem;margin-bottom:16px;">–í—ã–ø–µ–∫–∞–µ–º...</div>
    <div class="bake-bar-wrap">
      <div class="bake-bar" id="bake-bar"></div>
    </div>
    <div class="bake-text" id="bake-text">–†–∞–∑–æ–≥—Ä–µ–≤–∞–µ–º –¥–æ 350¬∞C...</div>
  </div>

  <div class="final-reveal" id="final-reveal">
    <div class="final-pizza">üçï</div>
    <div class="final-title" id="final-pizza-name">–ì–æ—Ç–æ–≤–æ!</div>
    <div class="final-subtitle">–¢–≤–æ—è –ø–∏—Ü—Ü–∞ –≤—ã–≥–ª—è–¥–∏—Ç –≤–æ—Å—Ö–∏—Ç–∏—Ç–µ–ª—å–Ω–æ! ü§©</div>
    <button class="btn btn-order" onclick="closeCooking()" style="margin:0 auto;font-size:1.1rem;padding:14px 36px;">
      üéâ –û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑!
    </button>
  </div>
</div>

<!-- Toast -->
<div class="toast" id="toast"></div>

<!-- Order Modal -->
<div class="modal-overlay" id="modal-overlay">
  <div class="modal">
    <h2>–ó–∞–∫–∞–∑ –ø—Ä–∏–Ω—è—Ç!</h2>
    <span class="modal-pizza-emoji">üçï</span>
    <p id="modal-pizza-name" style="font-size:1.3rem; color: var(--sauce); font-family:'Pacifico',cursive;"></p>
    <p id="modal-summary"></p>
    <p id="modal-price" style="font-size:1.5rem; color: var(--dark);"></p>
    <p style="margin-top: 12px; font-size: 0.9rem; color:#b0956d;">–í–∞—à–∞ –ø–∏—Ü—Ü–∞ —É–∂–µ –≥–æ—Ç–æ–≤–∏—Ç—Å—è –Ω–∞ –∫—É—Ö–Ω–µ üë®‚Äçüç≥</p>
    <button class="btn btn-order" onclick="closeModal()" style="margin: 0 auto; margin-top: 20px;">üéâ –û—Ç–ª–∏—á–Ω–æ!</button>
  </div>
</div>

<script>
// ======================== DATA ========================
const BASE_PRICE = 149;

const ingredients = {
  sauce: [
    { id: 's1', name: '–¢–æ–º–∞—Ç–Ω—ã–π', emoji: 'üçÖ', price: 0, color: '#d94f2c' },
    { id: 's2', name: '–°–ª–∏–≤–æ—á–Ω—ã–π', emoji: 'üç∂', price: 20, color: '#fffacd' },
    { id: 's3', name: '–ë–∞—Ä–±–µ–∫—é', emoji: 'üç´', price: 25, color: '#5a2d00' },
    { id: 's4', name: '–û—Å—Ç—Ä—ã–π', emoji: 'üå∂Ô∏è', price: 15, color: '#e63900' },
  ],
  cheese: [
    { id: 'c1', name: '–ú–æ—Ü–∞—Ä–µ–ª–ª–∞', emoji: 'üßÄ', price: 40, color: '#f5c842' },
    { id: 'c2', name: '–ü–∞—Ä–º–µ–∑–∞–Ω', emoji: 'ü´ô', price: 55, color: '#d4a52a' },
    { id: 'c3', name: '–ì–æ—Ä–≥–æ–Ω–∑–æ–ª–∞', emoji: 'ü´ß', price: 65, color: '#8fbc8f' },
    { id: 'c4', name: '–ë—Ä–∏', emoji: 'üç∞', price: 60, color: '#fffde7' },
  ],
  meat: [
    { id: 'm1', name: '–ü–µ–ø–ø–µ—Ä–æ–Ω–∏', emoji: 'üå≠', price: 70 },
    { id: 'm2', name: '–ë–µ–∫–æ–Ω', emoji: 'ü•ì', price: 65 },
    { id: 'm3', name: '–ö—É—Ä–∏—Ü–∞', emoji: 'üçó', price: 60 },
    { id: 'm4', name: '–í–µ—Ç—á–∏–Ω–∞', emoji: 'üçñ', price: 60 },
    { id: 'm5', name: '–¢—É–Ω–µ—Ü', emoji: 'üêü', price: 75 },
    { id: 'm6', name: '–ì–æ–≤—è–¥–∏–Ω–∞', emoji: 'ü•©', price: 80 },
  ],
  veggie: [
    { id: 'v1', name: '–®–∞–º–ø–∏–Ω—å–æ–Ω—ã', emoji: 'üçÑ', price: 30 },
    { id: 'v2', name: '–ü–µ—Ä–µ—Ü', emoji: 'ü´ë', price: 25 },
    { id: 'v3', name: '–õ—É–∫', emoji: 'üßÖ', price: 15 },
    { id: 'v4', name: '–û–ª–∏–≤–∫–∏', emoji: 'ü´í', price: 35 },
    { id: 'v5', name: '–¢–æ–º–∞—Ç—ã', emoji: 'üçÖ', price: 25 },
    { id: 'v6', name: '–ö—É–∫—É—Ä—É–∑–∞', emoji: 'üåΩ', price: 20 },
    { id: 'v7', name: '–®–ø–∏–Ω–∞—Ç', emoji: 'ü•¨', price: 30 },
    { id: 'v8', name: '–†—É–∫–∫–æ–ª–∞', emoji: 'üåø', price: 35 },
  ],
  extra: [
    { id: 'e1', name: '–Ø–π—Ü–æ', emoji: 'üç≥', price: 30 },
    { id: 'e2', name: '–ê–Ω–∞–Ω–∞—Å', emoji: 'üçç', price: 35 },
    { id: 'e3', name: '–ú—ë–¥', emoji: 'üçØ', price: 20 },
    { id: 'e4', name: '–¢—Ä—é—Ñ–µ–ª—å', emoji: 'üîÆ', price: 120 },
    { id: 'e5', name: '–ê–≤–æ–∫–∞–¥–æ', emoji: 'ü•ë', price: 55 },
  ]
};

// ======================== STATE ========================
let state = {
  sauce: null,
  cheese: null,
  toppings: {}, // id -> count
  crust: '—Ç–æ–Ω–∫–æ–µ'
};

// ======================== RENDER GRIDS ========================
function renderGrid(gridId, items, category) {
  const grid = document.getElementById(gridId);
  grid.innerHTML = items.map(item => `
    <button class="ingredient-btn ${category === 'sauce' ? 'sauce-btn' : ''}"
      id="btn-${item.id}"
      onclick="toggleIngredient('${category}', '${item.id}')"
      title="${item.name} (+${item.price}‚ÇΩ)"
    >
      <span class="emoji">${item.emoji}</span>
      <span class="name">${item.name}</span>
      <span class="price">${item.price ? '+' + item.price + '‚ÇΩ' : '–±–µ—Å–ø–ª–∞—Ç–Ω–æ'}</span>
      <span class="count-badge" id="count-${item.id}">1</span>
    </button>
  `).join('');
}

renderGrid('sauce-grid', ingredients.sauce, 'sauce');
renderGrid('cheese-grid', ingredients.cheese, 'cheese');
renderGrid('meat-grid', ingredients.meat, 'meat');
renderGrid('veggie-grid', ingredients.veggie, 'veggie');
renderGrid('extra-grid', ingredients.extra, 'extra');

// ======================== TOGGLE ========================
function getItemById(id) {
  for (const cat of Object.values(ingredients)) {
    const found = cat.find(i => i.id === id);
    if (found) return found;
  }
  return null;
}

function toggleIngredient(category, id) {
  const btn = document.getElementById('btn-' + id);

  if (category === 'sauce') {
    // Deselect old
    if (state.sauce && state.sauce !== id) {
      document.getElementById('btn-' + state.sauce)?.classList.remove('selected');
    }
    if (state.sauce === id) {
      state.sauce = null;
      btn.classList.remove('selected');
    } else {
      state.sauce = id;
      btn.classList.add('selected');
    }
  } else if (category === 'cheese') {
    if (state.cheese && state.cheese !== id) {
      document.getElementById('btn-' + state.cheese)?.classList.remove('selected');
    }
    if (state.cheese === id) {
      state.cheese = null;
      btn.classList.remove('selected');
    } else {
      state.cheese = id;
      btn.classList.add('selected');
    }
  } else {
    // Toppings - allow multiple, up to 3 of same
    const cur = state.toppings[id] || 0;
    if (cur >= 3) {
      delete state.toppings[id];
      btn.classList.remove('selected');
    } else {
      state.toppings[id] = cur + 1;
      btn.classList.add('selected');
    }
    const badge = document.getElementById('count-' + id);
    const count = state.toppings[id] || 0;
    badge.style.display = count > 1 ? 'flex' : 'none';
    badge.textContent = count;
  }

  renderPizza();
  updateRecipe();
  updatePrice();
}

// ======================== PIZZA VISUAL ========================
function renderPizza() {
  // Sauce layer
  const sauceLayer = document.getElementById('sauce-layer');
  if (state.sauce) {
    const item = getItemById(state.sauce);
    sauceLayer.style.opacity = '1';
    // color variations
    const colors = {
      s1: 'radial-gradient(circle at 35% 30%, #e8553a, #b52d10)',
      s2: 'radial-gradient(circle at 35% 30%, #fff9c4, #f0e68c)',
      s3: 'radial-gradient(circle at 35% 30%, #8b4513, #4a1a00)',
      s4: 'radial-gradient(circle at 35% 30%, #ff4500, #cc0000)',
    };
    sauceLayer.style.background = colors[state.sauce] || colors.s1;
  } else {
    sauceLayer.style.opacity = '0';
  }

  // Cheese layer
  const cheeseLayer = document.getElementById('cheese-layer');
  if (state.cheese && state.sauce) {
    cheeseLayer.style.opacity = '1';
    const colors = {
      c1: 'radial-gradient(circle at 40% 35%, #ffe97a, #f0c020)',
      c2: 'radial-gradient(circle at 40% 35%, #deb887, #c8a040)',
      c3: 'radial-gradient(circle at 40% 35%, #90ee90, #6ab04c)',
      c4: 'radial-gradient(circle at 40% 35%, #fffde7, #f5f5dc)',
    };
    cheeseLayer.style.background = colors[state.cheese] || colors.c1;
  } else {
    cheeseLayer.style.opacity = '0';
  }

  // Toppings
  const toppingsLayer = document.getElementById('toppings-layer');
  toppingsLayer.innerHTML = '';

  Object.entries(state.toppings).forEach(([id, count]) => {
    if (!count) return;
    const item = getItemById(id);
    if (!item) return;

    // Place emojis in semi-random positions on pizza
    for (let i = 0; i < count; i++) {
      const positions = getPositions(id, i, count);
      const el = document.createElement('span');
      el.className = 'topping-item';
      el.textContent = item.emoji;
      el.style.left = positions.x + 'px';
      el.style.top = positions.y + 'px';
      toppingsLayer.appendChild(el);
    }
  });
}

function getPositions(id, index, total) {
  // Deterministic semi-random positions inside pizza circle
  const seed = id.charCodeAt(0) + id.charCodeAt(1) * 13 + index * 57;
  const rand = (n, offset=0) => ((seed * (n+1) * 2654435761) >>> 0) % 100 / 100 * 0.8 + offset * 0.1;

  const cx = 170, cy = 170, r = 120;
  const angle = (rand(1) + index/total) * 2 * Math.PI;
  const dist = rand(2) * r * 0.75 + 30;
  const x = cx + Math.cos(angle) * dist - 14;
  const y = cy + Math.sin(angle) * dist - 14;
  return { x: Math.max(40, Math.min(290, x)), y: Math.max(40, Math.min(290, y)) };
}

// ======================== RECIPE ========================
function updateRecipe() {
  const display = document.getElementById('recipe-display');
  const chips = [];

  if (state.sauce) {
    const item = getItemById(state.sauce);
    chips.push({ id: state.sauce, label: item.emoji + ' ' + item.name, type: 'sauce' });
  }
  if (state.cheese) {
    const item = getItemById(state.cheese);
    chips.push({ id: state.cheese, label: item.emoji + ' ' + item.name, type: 'cheese' });
  }
  Object.entries(state.toppings).forEach(([id, count]) => {
    if (!count) return;
    const item = getItemById(id);
    chips.push({ id, label: item.emoji + ' ' + item.name + (count > 1 ? ' x' + count : ''), type: 'topping' });
  });

  if (!chips.length) {
    display.innerHTML = '<span class="empty">–î–æ–±–∞–≤–ª—è–π –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã, —á—Ç–æ–±—ã —Å–æ–±—Ä–∞—Ç—å –ø–∏—Ü—Ü—É!</span>';
    return;
  }

  display.innerHTML = chips.map(c =>
    `<span class="recipe-chip" onclick="removeIngredient('${c.type}','${c.id}')">
      ${c.label} <span class="remove">√ó</span>
    </span>`
  ).join('');
}

function removeIngredient(type, id) {
  if (type === 'sauce') state.sauce = null;
  else if (type === 'cheese') state.cheese = null;
  else {
    delete state.toppings[id];
    document.getElementById('count-' + id).style.display = 'none';
  }
  document.getElementById('btn-' + id)?.classList.remove('selected');
  renderPizza();
  updateRecipe();
  updatePrice();
}

// ======================== PRICE ========================
function updatePrice() {
  let price = BASE_PRICE;
  const crustPrices = { '—Ç–æ–Ω–∫–æ–µ': 0, '–∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–µ': 30, '—Ç–æ–ª—Å—Ç–æ–µ': 50 };
  price += crustPrices[state.crust] || 0;

  if (state.sauce) price += getItemById(state.sauce).price;
  if (state.cheese) price += getItemById(state.cheese).price;
  Object.entries(state.toppings).forEach(([id, count]) => {
    price += getItemById(id).price * count;
  });

  document.getElementById('total-price').textContent = price;
}

// ======================== CRUST ========================
function setCrust(type, btn) {
  state.crust = type;
  document.querySelectorAll('.crust-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  updatePrice();
}

// ======================== ACTIONS ========================
function resetPizza() {
  state.sauce = null;
  state.cheese = null;
  state.toppings = {};

  document.querySelectorAll('.ingredient-btn').forEach(b => b.classList.remove('selected'));
  document.querySelectorAll('.count-badge').forEach(b => { b.style.display='none'; b.textContent='1'; });

  renderPizza();
  updateRecipe();
  updatePrice();
  showToast('üîÑ –ü–∏—Ü—Ü–∞ —Å–±—Ä–æ—à–µ–Ω–∞! –ù–∞—á–Ω–∏ —Å–Ω–∞—á–∞–ª–∞');
}

function savePizza() {
  const name = document.getElementById('pizza-name').value || '–ú–æ—è –ø–∏—Ü—Ü–∞';
  showToast('üíæ ¬´' + name + '¬ª —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!');
}

function orderPizza() {
  startCookingAnimation();
}

// ======================== COOKING ANIMATION ========================
function startCookingAnimation() {
  const overlay = document.getElementById('cooking-overlay');
  overlay.classList.add('show');

  // Reset all phases
  document.getElementById('assembly-phase').style.display = 'block';
  document.getElementById('baking-phase').classList.remove('active');
  document.getElementById('final-reveal').classList.remove('active');
  document.getElementById('cook-progress').style.width = '0%';
  document.getElementById('cook-toppings').innerHTML = '';
  document.getElementById('cook-sauce').style.opacity = '0';
  document.getElementById('cook-cheese').style.opacity = '0';
  document.getElementById('stage-label').textContent = '–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤...';

  // Sparks
  spawnSparks();

  // Build steps list
  const steps = buildCookingSteps();
  let stepIdx = 0;
  const total = steps.length;

  function runStep() {
    if (stepIdx >= total) {
      // All assembled ‚Üí bake
      setTimeout(startBaking, 400);
      return;
    }
    const step = steps[stepIdx];
    document.getElementById('cook-progress').style.width = ((stepIdx + 1) / total * 100) + '%';
    document.getElementById('stage-label').style.opacity = '0';
    setTimeout(() => {
      document.getElementById('stage-label').textContent = step.label;
      document.getElementById('stage-label').style.opacity = '1';
    }, 200);

    step.action();
    stepIdx++;
    setTimeout(runStep, step.delay || 800);
  }

  setTimeout(runStep, 600);
}

function buildCookingSteps() {
  const steps = [];

  // Crust step
  steps.push({
    label: `ü´ì –†–∞—Å–∫–∞—Ç—ã–≤–∞–µ–º —Ç–µ—Å—Ç–æ (${state.crust})...`,
    delay: 900,
    action: () => {
      const el = document.getElementById('cook-crust');
      el.style.transform = 'scale(0.5)';
      el.style.transition = 'transform 0.6s cubic-bezier(0.34,1.56,0.64,1)';
      el.style.background = 'radial-gradient(circle at 30% 30%, #f0c580, #c8813a)';
      setTimeout(() => el.style.transform = 'scale(1)', 50);
    }
  });

  // Sauce
  if (state.sauce) {
    const sauceColors = {
      s1: 'radial-gradient(circle at 35% 30%, #e8553a, #b52d10)',
      s2: 'radial-gradient(circle at 35% 30%, #fff9c4, #f0e68c)',
      s3: 'radial-gradient(circle at 35% 30%, #8b4513, #4a1a00)',
      s4: 'radial-gradient(circle at 35% 30%, #ff4500, #cc0000)',
    };
    const sauceItem = getItemById(state.sauce);
    steps.push({
      label: `${sauceItem.emoji} –ù–∞–Ω–æ—Å–∏–º ${sauceItem.name} —Å–æ—É—Å...`,
      delay: 900,
      action: () => {
        const el = document.getElementById('cook-sauce');
        el.style.background = sauceColors[state.sauce];
        el.style.transform = 'scale(0)';
        el.style.transition = 'opacity 0.1s, transform 0.6s cubic-bezier(0.34,1.56,0.64,1)';
        el.style.opacity = '1';
        setTimeout(() => el.style.transform = 'scale(1)', 50);
        spawnSplash('cook-pizza', '#d94f2c');
      }
    });
  }

  // Cheese
  if (state.cheese) {
    const cheeseColors = {
      c1: 'radial-gradient(circle at 40% 35%, #ffe97a, #f0c020)',
      c2: 'radial-gradient(circle at 40% 35%, #deb887, #c8a040)',
      c3: 'radial-gradient(circle at 40% 35%, #90ee90, #6ab04c)',
      c4: 'radial-gradient(circle at 40% 35%, #fffde7, #f5f5dc)',
    };
    const cheeseItem = getItemById(state.cheese);
    steps.push({
      label: `${cheeseItem.emoji} –ü–æ—Å—ã–ø–∞–µ–º ${cheeseItem.name}...`,
      delay: 950,
      action: () => {
        const el = document.getElementById('cook-cheese');
        el.style.background = cheeseColors[state.cheese];
        el.style.transform = 'scale(0)';
        el.style.transition = 'opacity 0.1s, transform 0.7s cubic-bezier(0.34,1.56,0.64,1)';
        el.style.opacity = '1';
        setTimeout(() => el.style.transform = 'scale(1)', 50);
        spawnSplash('cook-pizza', '#f5c842');
        spawnFlyingEmoji(cheeseItem.emoji, 'cook-pizza');
      }
    });
  }

  // Toppings
  Object.entries(state.toppings).forEach(([id, count]) => {
    const item = getItemById(id);
    for (let i = 0; i < count; i++) {
      steps.push({
        label: `${item.emoji} –î–æ–±–∞–≤–ª—è–µ–º ${item.name}${count > 1 ? ` (${i+1}/${count})` : ''}...`,
        delay: 700,
        action: () => {
          const pos = getPositions(id, i, count);
          // Scale position from 340 to 320
          const sx = pos.x * 320/340;
          const sy = pos.y * 320/340;
          addCookTopping(item.emoji, sx, sy);
          spawnFlyingEmoji(item.emoji, 'cook-pizza');
        }
      });
    }
  });

  return steps;
}

function addCookTopping(emoji, x, y) {
  const layer = document.getElementById('cook-toppings');
  const el = document.createElement('span');
  el.style.cssText = `position:absolute;font-size:1.5rem;left:${x}px;top:${y}px;
    animation:popIn 0.35s cubic-bezier(0.34,1.56,0.64,1);
    filter:drop-shadow(1px 2px 3px rgba(0,0,0,0.3));user-select:none;`;
  el.textContent = emoji;
  layer.appendChild(el);
}

function spawnFlyingEmoji(emoji, targetId) {
  const target = document.getElementById(targetId);
  const rect = target.getBoundingClientRect();
  const el = document.createElement('div');
  el.className = 'fly-ingredient';
  el.textContent = emoji;
  const startX = rect.left + rect.width / 2 - 24;
  const startY = rect.top - 100;
  el.style.left = startX + 'px';
  el.style.top = startY + 'px';
  el.style.position = 'fixed';
  document.body.appendChild(el);
  setTimeout(() => el.remove(), 800);
}

function spawnSplash(parentId, color) {
  const parent = document.getElementById(parentId);
  const el = document.createElement('div');
  el.className = 'splash';
  el.style.cssText = `width:60px;height:60px;top:50%;left:50%;
    margin:-30px 0 0 -30px;background:${color}55;`;
  parent.appendChild(el);
  setTimeout(() => el.remove(), 600);
}

function spawnSparks() {
  const bg = document.getElementById('kitchen-bg');
  bg.innerHTML = '';
  for (let i = 0; i < 20; i++) {
    const s = document.createElement('div');
    s.className = 'spark';
    s.style.cssText = `
      left:${Math.random()*100}%;
      bottom:${Math.random()*30}%;
      width:${Math.random()*6+2}px;
      height:${Math.random()*6+2}px;
      background:hsl(${30 + Math.random()*30},100%,60%);
      animation-duration:${1+Math.random()*2}s;
      animation-delay:${Math.random()*3}s;
    `;
    bg.appendChild(s);
  }
}

function startBaking() {
  document.getElementById('assembly-phase').style.display = 'none';
  document.getElementById('baking-phase').classList.add('active');
  document.getElementById('cooking-title').textContent = 'üî• –í –ø–µ—á–∏!';
  document.getElementById('stage-label').textContent = '';

  const bakeBar = document.getElementById('bake-bar');
  const bakeText = document.getElementById('bake-text');
  const msgs = [
    '–†–∞–∑–æ–≥—Ä–µ–≤–∞–µ–º –¥–æ 350¬∞C... üå°Ô∏è',
    '–¢–µ—Å—Ç–æ –ø–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è... ‚¨ÜÔ∏è',
    '–°—ã—Ä –ø–ª–∞–≤–∏—Ç—Å—è... üßÄ',
    '–ö–æ—Ä–æ—á–∫–∞ –∑–æ–ª–æ—Ç–∏—Ç—Å—è... ‚ú®',
    '–ê—Ä–æ–º–∞—Ç —Ä–∞–∑–Ω–æ—Å–∏—Ç—Å—è –ø–æ –∫—É—Ö–Ω–µ... üòã',
    '–ü–æ—Å–ª–µ–¥–Ω–∏–µ —à—Ç—Ä–∏—Ö–∏... üé®',
    '–ì–æ—Ç–æ–≤–æ! üçï',
  ];
  let pct = 0;
  let msgIdx = 0;

  const interval = setInterval(() => {
    pct += 1.4;
    bakeBar.style.width = Math.min(pct, 100) + '%';
    const mIdx = Math.floor((pct / 100) * msgs.length);
    if (mIdx !== msgIdx && mIdx < msgs.length) {
      msgIdx = mIdx;
      bakeText.textContent = msgs[msgIdx];
    }
    if (pct >= 100) {
      clearInterval(interval);
      setTimeout(showFinalReveal, 400);
    }
  }, 35);
}

function showFinalReveal() {
  document.getElementById('baking-phase').classList.remove('active');
  document.getElementById('final-reveal').classList.add('active');
  document.getElementById('cooking-title').textContent = '';
  document.getElementById('stage-label').textContent = '';

  const name = document.getElementById('pizza-name').value || '–¢–≤–æ—è –ø–∏—Ü—Ü–∞';
  document.getElementById('final-pizza-name').textContent = '¬´' + name + '¬ª';

  // Confetti!
  spawnConfetti();
}

function spawnConfetti() {
  const colors = ['#ff6b35','#ffd700','#ff4757','#2ed573','#1e90ff','#ff6348','#eccc68'];
  const overlay = document.getElementById('cooking-overlay');
  for (let i = 0; i < 50; i++) {
    setTimeout(() => {
      const c = document.createElement('div');
      c.className = 'confetti-piece';
      c.style.cssText = `
        left:${Math.random()*100}%;
        top:-20px;
        background:${colors[Math.floor(Math.random()*colors.length)]};
        width:${Math.random()*12+6}px;
        height:${Math.random()*12+6}px;
        border-radius:${Math.random() > 0.5 ? '50%' : '2px'};
        animation-duration:${1.5 + Math.random()*2}s;
        animation-delay:${Math.random()*0.5}s;
      `;
      overlay.appendChild(c);
      setTimeout(() => c.remove(), 3000);
    }, i * 40);
  }
}

function closeCooking() {
  document.getElementById('cooking-overlay').classList.remove('show');
  // Show order modal
  const name = document.getElementById('pizza-name').value || '–ú–æ—è –ø–∏—Ü—Ü–∞';
  const price = document.getElementById('total-price').textContent;
  let parts = [];
  if (state.sauce) parts.push(getItemById(state.sauce).name + ' —Å–æ—É—Å');
  if (state.cheese) parts.push(getItemById(state.cheese).name);
  Object.entries(state.toppings).forEach(([id]) => parts.push(getItemById(id).name));
  document.getElementById('modal-pizza-name').textContent = name;
  document.getElementById('modal-summary').textContent = parts.length ? '–°–æ—Å—Ç–∞–≤: ' + parts.join(', ') : '–ü—Ä–æ—Å—Ç–æ –∫–æ—Ä–∂ ‚Äî –±—Ä—É—Ç–∞–ª—å–Ω—ã–π –≤—ã–±–æ—Ä! üòÑ';
  document.getElementById('modal-price').textContent = 'üí∞ –ò—Ç–æ–≥–æ: ' + price + ' ‚ÇΩ';
  document.getElementById('modal-overlay').classList.add('show');
}

function closeModal() {
  document.getElementById('modal-overlay').classList.remove('show');
  showToast('üçï –°–ø–∞—Å–∏–±–æ –∑–∞ –∑–∞–∫–∞–∑! –ì–æ—Ç–æ–≤–∏–º...');
}

document.getElementById('modal-overlay').addEventListener('click', function(e) {
  if (e.target === this) closeModal();
});

// ======================== TOAST ========================
function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2800);
}

// Init
renderPizza();
updatePrice();
</script>
</body>
</html>
