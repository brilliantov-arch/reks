<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>–ü–†–û–ö–ê–ß–ê–ô –ù–û–°–¢–ê–õ–¨–ì–ò–Æ</title>
<link href="https://fonts.googleapis.com/css2?family=Russo+One&family=Oswald:wght@400;700&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

:root {
  --yellow: #ffd700;
  --green: #00e600;
  --orange: #ff6b00;
  --purple: #7b2fbf;
  --dark-purple: #3a1060;
  --bg: linear-gradient(160deg, #ff2d9b 0%, #cc00aa 45%, #7b2fbf 100%);
  --panel: rgba(40,8,80,0.78);
}

html, body {
  height: 100%;
  font-family: 'Russo One', sans-serif;
  background: var(--bg);
  background-attachment: fixed;
  overflow-x: hidden;
  color: white;
}

body::before {
  content: '';
  position: fixed; inset: 0;
  background-image: radial-gradient(circle, rgba(255,255,255,.07) 1.5px, transparent 1.5px);
  background-size: 28px 28px;
  pointer-events: none; z-index: 0;
}

/* ‚îÄ‚îÄ‚îÄ SHELL ‚îÄ‚îÄ‚îÄ */
.shell {
  position: relative; z-index: 1;
  max-width: 960px; margin: 0 auto;
  min-height: 100dvh;
  display: flex; flex-direction: column;
  padding-bottom: env(safe-area-inset-bottom, 0);
}

/* ‚îÄ‚îÄ‚îÄ TOP BAR ‚îÄ‚îÄ‚îÄ */
.topbar {
  display: flex; align-items: center; gap: 6px;
  padding: 8px 10px;
  background: rgba(0,0,0,.25);
  border-bottom: 2px solid rgba(255,215,0,.2);
  flex-shrink: 0;
}

.player-card {
  display: flex; align-items: center; gap: 6px;
  background: rgba(0,0,0,.3); border: 2px solid var(--yellow);
  border-radius: 12px; padding: 4px 8px;
}

.avatar {
  width: 36px; height: 36px; border-radius: 50%;
  border: 2px solid var(--yellow);
  background: linear-gradient(135deg,#333,#666);
  font-size: 20px; display: flex; align-items: center; justify-content: center;
  flex-shrink: 0;
}

.score-badge {
  background: var(--yellow); color: #000;
  font-size: clamp(11px,3.4vw,17px); font-weight: 900;
  padding: 2px 10px; border-radius: 20px; white-space: nowrap;
}

.rank {
  color: rgba(255,255,255,.65); font-size: clamp(8px,2vw,10px);
  margin-top: 2px; font-family: 'Oswald',sans-serif; white-space: nowrap;
}

.title-logo { flex: 1; text-align: center; min-width: 0; padding: 0 4px; }

.title-logo .sub {
  font-family: 'Oswald',sans-serif; color: rgba(255,255,255,.65);
  font-size: clamp(7px,1.8vw,10px); letter-spacing: 3px; display: block;
}

.title-logo .main {
  font-size: clamp(12px,3.2vw,22px);
  text-shadow: 2px 2px 0 #7b2fbf, -1px -1px 0 rgba(0,0,0,.4);
  line-height: 1.1; white-space: nowrap;
}
.title-logo .main span { color: var(--yellow); }

.coins-block {
  display: flex; align-items: center; gap: 4px;
  background: rgba(0,0,0,.3); border: 2px solid var(--yellow);
  border-radius: 12px; padding: 4px 8px; flex-shrink: 0;
}

.coin-icon { font-size: 18px; }
.coin-count { font-size: clamp(13px,3.4vw,17px); font-weight: 900; min-width: 26px; }

.add-btn {
  background: var(--green); border: none; border-radius: 50%;
  width: 28px; height: 28px; font-size: 18px; font-weight: 900;
  cursor: pointer; color: white;
  display: flex; align-items: center; justify-content: center;
  transition: transform .1s; flex-shrink: 0;
}
.add-btn:active { transform: scale(.88); }

.promo-badge {
  background: linear-gradient(135deg,#ff2200,#ff6600);
  color: white; font-size: 10px; padding: 2px 6px;
  border-radius: 20px; border: 1.5px solid var(--yellow);
  white-space: nowrap; flex-shrink: 0;
}

/* ‚îÄ‚îÄ‚îÄ CONTENT GRID ‚îÄ‚îÄ‚îÄ */
.content-area {
  flex: 1; display: grid;
  grid-template-columns: 1fr 310px;
  gap: 10px; padding: 10px;
  align-items: start;
  overflow-y: auto;
}

/* ‚îÄ‚îÄ‚îÄ CLICKER COLUMN ‚îÄ‚îÄ‚îÄ */
.clicker-col {
  display: flex; flex-direction: column;
  align-items: center; gap: 10px; padding-bottom: 10px;
}

.star-score {
  display: flex; align-items: center; gap: 8px;
  font-size: clamp(28px,6vw,48px); font-weight: 900;
  text-shadow: 3px 3px 0 rgba(0,0,0,.35);
}

.star-icon { filter: drop-shadow(0 0 8px gold); }

.per-sec {
  font-family: 'Oswald',sans-serif;
  font-size: clamp(13px,3vw,16px);
  color: rgba(255,255,255,.85); letter-spacing: 1px;
}
.per-sec span { color: var(--green); font-size: 1.25em; font-weight: 700; }

.clicker-ring {
  width: clamp(190px,50vw,300px); height: clamp(190px,50vw,300px);
  border-radius: 50%;
  background: radial-gradient(circle at 35% 35%, #ffeb80 0%,#ffa500 40%,#ff6600 70%,#cc3300 100%);
  box-shadow: 0 0 0 6px rgba(255,165,0,.3), 0 0 0 14px rgba(255,165,0,.14),
              0 0 55px rgba(255,100,0,.5), inset 0 -15px 35px rgba(0,0,0,.2);
  display: flex; align-items: center; justify-content: center;
  cursor: pointer; user-select: none;
  transition: transform .08s;
  animation: ring-pulse 3s ease-in-out infinite;
  touch-action: manipulation;
}

@keyframes ring-pulse {
  0%,100% { box-shadow: 0 0 0 6px rgba(255,165,0,.3),0 0 0 14px rgba(255,165,0,.14),0 0 55px rgba(255,100,0,.5),inset 0 -15px 35px rgba(0,0,0,.2); }
  50%      { box-shadow: 0 0 0 10px rgba(255,165,0,.4),0 0 0 22px rgba(255,165,0,.2),0 0 75px rgba(255,100,0,.7),inset 0 -15px 35px rgba(0,0,0,.2); }
}

.clicker-ring:active { transform: scale(.91); }

.sneaker {
  font-size: clamp(70px,18vw,120px);
  filter: drop-shadow(0 8px 16px rgba(0,0,0,.4));
  pointer-events: none;
}

.progress-wrap {
  width: min(90%,300px);
  background: rgba(0,0,0,.3); border-radius: 10px;
  height: 14px; border: 2px solid rgba(255,255,255,.25); overflow: hidden;
}

.progress-fill {
  height: 100%;
  background: linear-gradient(90deg,var(--yellow),var(--orange));
  border-radius: 8px; transition: width .3s ease;
}

.level-info {
  font-family: 'Oswald',sans-serif; color: rgba(255,255,255,.6);
  font-size: clamp(11px,2.5vw,13px); text-align: center; padding: 0 10px;
}

.upgrade-btn {
  background: linear-gradient(180deg,#ffd700,#ff9000);
  color: #000; border: none; border-radius: 14px;
  padding: 13px 28px;
  font-family: 'Russo One',sans-serif;
  font-size: clamp(14px,3.5vw,18px);
  cursor: pointer; text-transform: uppercase; letter-spacing: .5px;
  box-shadow: 0 5px 0 #aa5500, 0 7px 18px rgba(0,0,0,.3);
  transition: all .1s; width: min(88%,300px);
  touch-action: manipulation;
}
.upgrade-btn:hover  { filter: brightness(1.08); }
.upgrade-btn:active { transform: translateY(3px); box-shadow: 0 2px 0 #aa5500; }
.upgrade-btn:disabled {
  background: linear-gradient(180deg,#888,#555);
  color: #333; box-shadow: 0 4px 0 #333; cursor: not-allowed;
}

.obj-stars {
  font-family: 'Oswald',sans-serif;
  font-size: clamp(13px,3vw,15px); color: rgba(255,255,255,.8);
}

/* click particle */
.click-particle {
  position: fixed;
  font-family: 'Russo One',sans-serif; font-size: 22px; font-weight: 900;
  color: var(--yellow); text-shadow: 2px 2px 0 #000;
  pointer-events: none;
  animation: flyup .8s ease-out forwards;
  z-index: 9999; transform: translateX(-50%);
}
@keyframes flyup {
  from { opacity:1; transform:translateX(-50%) translateY(0) scale(1); }
  to   { opacity:0; transform:translateX(-50%) translateY(-72px) scale(1.4); }
}

/* ‚îÄ‚îÄ‚îÄ RIGHT PANEL ‚îÄ‚îÄ‚îÄ */
.right-panel {
  background: var(--panel);
  border: 3px solid rgba(255,215,0,.35);
  border-radius: 20px; overflow: hidden;
  backdrop-filter: blur(8px);
}

.panel-duck-row {
  display: flex; align-items: center; gap: 8px;
  padding: 10px 14px; background: rgba(0,0,0,.2);
}

.duck-av {
  width: 40px; height: 40px; border-radius: 50%;
  background: linear-gradient(135deg,#ffd700,#ff9000);
  border: 2.5px solid var(--yellow);
  display: flex; align-items: center; justify-content: center;
  font-size: 22px; flex-shrink: 0;
}

.panel-title {
  font-size: clamp(14px,3.5vw,18px); color: var(--yellow);
  text-shadow: 2px 2px 0 rgba(0,0,0,.35);
}

.boosters-row {
  display: flex; gap: 8px; padding: 8px 12px 12px; flex-wrap: wrap;
}

.booster-item {
  display: flex; flex-direction: column; align-items: center; gap: 3px; cursor: pointer;
}

.booster-btn {
  width: 52px; height: 52px; border-radius: 12px;
  border: 2.5px solid rgba(255,255,255,.3);
  display: flex; align-items: center; justify-content: center;
  font-size: 24px; cursor: pointer;
  transition: transform .12s; touch-action: manipulation;
}
.booster-btn:active { transform: scale(.86); }
.booster-btn.blue { background: linear-gradient(135deg,#2255ff,#0088ff); }
.booster-btn.red  { background: linear-gradient(135deg,#cc2200,#ff5500); }
.booster-btn.teal { background: linear-gradient(135deg,#007755,#00cc88); }
.booster-btn.grn  { background: linear-gradient(135deg,#448800,#88dd00); }

.booster-label {
  font-family: 'Oswald',sans-serif; font-size: 9px;
  color: rgba(255,255,255,.75); text-align: center; max-width: 56px;
}
.booster-label.gold { color: var(--yellow); }

.section-head {
  font-size: clamp(14px,3.5vw,18px); color: var(--yellow);
  padding: 8px 14px 4px;
  text-shadow: 2px 2px 0 rgba(0,0,0,.35);
  border-top: 2px solid rgba(255,255,255,.1);
}

.generators { padding-bottom: 6px; }

.gen-item {
  display: flex; align-items: center; gap: 8px;
  margin: 5px 8px; background: rgba(255,255,255,.06);
  border-radius: 12px; padding: 8px 10px;
  cursor: pointer; border: 2px solid transparent;
  transition: background .15s, border-color .15s;
  touch-action: manipulation;
}
.gen-item:active:not(.locked) { background: rgba(255,255,255,.16); border-color: rgba(255,215,0,.5); }
.gen-item.locked { opacity: .46; cursor: not-allowed; }

.gen-icon {
  width: 42px; height: 42px; border-radius: 10px;
  display: flex; align-items: center; justify-content: center;
  font-size: 24px; flex-shrink: 0;
}
.gen-icon.y  { background: linear-gradient(135deg,#ffd700,#ff9000); }
.gen-icon.lk { background: linear-gradient(135deg,#553399,#7744bb); }

.gen-info { flex: 1; min-width: 0; }
.gen-name { font-size: clamp(11px,2.5vw,13px); color: var(--orange); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.gen-name.lk { color: #998; }
.gen-cost { font-family: 'Oswald',sans-serif; font-size: clamp(9px,2.2vw,11px); color: rgba(255,255,255,.6); margin-top: 2px; }

.gen-count { font-size: clamp(18px,4vw,22px); font-weight: 900; min-width: 26px; text-align: right; flex-shrink: 0; }
.gen-count.lk { font-size: 9px; color: #998; line-height: 1.3; }

.shop-banner {
  background: linear-gradient(90deg,#009900,#006600);
  padding: 9px; text-align: center;
  font-size: clamp(12px,2.5vw,14px); color: var(--yellow);
  letter-spacing: 1px; border-top: 3px solid var(--yellow);
}

/* ‚îÄ‚îÄ‚îÄ BOTTOM BANNER (desktop) ‚îÄ‚îÄ‚îÄ */
.bottom-banner {
  background: linear-gradient(90deg,#009900,#006600);
  padding: 12px 16px; text-align: center;
  font-size: clamp(15px,4vw,26px); color: var(--yellow);
  text-shadow: 3px 3px 0 rgba(0,0,0,.4); letter-spacing: 2px;
  text-transform: uppercase;
  border-top: 4px solid var(--yellow); flex-shrink: 0;
  animation: bglow 2s ease-in-out infinite;
}
@keyframes bglow {
  0%,100% { box-shadow: inset 0 0 20px rgba(255,215,0,.15); }
  50%      { box-shadow: inset 0 0 40px rgba(255,215,0,.35); }
}

/* ‚îÄ‚îÄ‚îÄ MOBILE BOTTOM NAV ‚îÄ‚îÄ‚îÄ */
.mob-nav {
  display: none; position: fixed; bottom: 0; left: 0; right: 0;
  background: rgba(15,3,40,.97); border-top: 3px solid var(--yellow);
  z-index: 50; padding-bottom: env(safe-area-inset-bottom,0);
}
.mob-nav-inner { display: flex; }
.mob-tab {
  flex: 1; padding: 10px 4px 8px; text-align: center;
  cursor: pointer; border: none; background: transparent;
  color: rgba(255,255,255,.5); font-family: 'Russo One',sans-serif;
  font-size: 10px; display: flex; flex-direction: column;
  align-items: center; gap: 3px; transition: color .15s;
  touch-action: manipulation;
}
.mob-tab .ti { font-size: 22px; display: block; }
.mob-tab.active { color: var(--yellow); }
.mob-tab.active .ti { filter: drop-shadow(0 0 6px gold); }

/* ‚îÄ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ‚îÄ */
.modal-overlay {
  display: none; position: fixed; inset: 0;
  background: rgba(0,0,0,.72); z-index: 100;
  align-items: center; justify-content: center;
}
.modal-overlay.active { display: flex; }
.modal-box {
  background: linear-gradient(135deg,#7b2fbf,#3a1060);
  border: 4px solid var(--yellow); border-radius: 20px;
  padding: 28px 22px; text-align: center; width: min(320px,92vw);
  animation: pop-in .2s ease;
}
@keyframes pop-in { from{transform:scale(.85);opacity:0} to{transform:scale(1);opacity:1} }
.modal-box h2 { color: var(--yellow); font-size: 20px; margin-bottom: 8px; }
.modal-box p  { font-family:'Oswald',sans-serif; font-size:15px; margin-bottom:14px; color:rgba(255,255,255,.9); }
.modal-big { font-size: 40px; margin-bottom: 18px; }
.modal-btns { display: flex; gap: 10px; justify-content: center; }
.modal-btn { padding: 10px 22px; border: none; border-radius: 10px; font-family:'Russo One',sans-serif; font-size:15px; cursor:pointer; touch-action:manipulation; }
.modal-btn.confirm { background: var(--yellow); color: #000; }
.modal-btn.cancel  { background: rgba(255,255,255,.18); color: white; }

/* ‚îÄ‚îÄ‚îÄ RESPONSIVE ‚îÄ‚îÄ‚îÄ */
@media (max-width: 780px) {
  .content-area { grid-template-columns: 1fr 260px; gap: 8px; padding: 8px; }
  .booster-btn { width: 46px; height: 46px; font-size: 21px; }
}

@media (max-width: 600px) {
  /* Stack: one column, bottom tabs */
  .content-area { display: block; padding: 8px 8px 76px; }
  .right-panel  { display: none; }
  .right-panel.mob-active   { display: block; }
  .clicker-col  { display: none; }
  .clicker-col.mob-active   { display: flex; }
  .mob-nav { display: block; }
  .bottom-banner { display: none; }
  .title-logo .sub { display: none; }
  .promo-badge { display: none; }
  /* bigger ring on phone */
  .clicker-ring { width: min(74vw,290px); height: min(74vw,290px); }
  .sneaker { font-size: min(30vw,115px); }
}

@media (max-width: 380px) {
  .topbar { padding: 5px 6px; gap: 4px; }
  .avatar { width: 28px; height: 28px; font-size: 16px; }
  .score-badge { font-size: 10px; padding: 2px 7px; }
  .coin-icon { font-size: 15px; }
  .add-btn { width: 24px; height: 24px; font-size: 14px; }
}
</style>
</head>
<body>
<div class="shell">

  <!-- TOP BAR -->
  <header class="topbar">
    <div class="player-card">
      <div class="avatar">üêß</div>
      <div>
        <div class="score-badge" id="topScore">‚≠ê 2 304</div>
        <div class="rank" id="rankDisplay">–í—ã –Ω–∞ 788 –º–µ—Å—Ç–µ</div>
      </div>
    </div>

    <div class="title-logo">
      <span class="sub">–¢–ê–ö–ê–Ø –í–û–¢</span>
      <div class="main"><span>–í–ï–ß–ù–ê–Ø</span> –ú–û–õ–û–î–û–°–¢–¨</div>
    </div>

    <div style="display:flex;flex-direction:column;align-items:center;gap:4px;flex-shrink:0">
      <div class="coins-block">
        <span class="coin-icon">ü™ô</span>
        <span class="coin-count" id="coinCount">0</span>
        <button class="add-btn" onclick="openModal()">+</button>
      </div>
      <span class="promo-badge">–ê–∫—Ü–∏—è √ó3</span>
    </div>
  </header>

  <!-- CONTENT -->
  <div class="content-area">

    <!-- CLICKER -->
    <div class="clicker-col mob-active" id="clickerCol">
      <div class="star-score"><span class="star-icon">‚≠ê</span><span id="mainScore">2 301</span></div>
      <div class="per-sec">–í —Å–µ–∫—É–Ω–¥—É:&nbsp;<span id="perSec">+0</span></div>

      <div class="clicker-ring" id="clickerRing">
        <span class="sneaker">üëü</span>
      </div>

      <div class="progress-wrap">
        <div class="progress-fill" id="progressFill" style="width:40%"></div>
      </div>
      <div class="level-info" id="levelInfo">–î–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ —É—Ä–æ–≤–Ω—è: 699 ‚≠ê</div>

      <button class="upgrade-btn" id="upgradeBtn" onclick="upgrade()">–£–≤–µ–ª–∏—á–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å</button>
      <div class="obj-stars">‚≠ê –û–±—ä–µ–∫—Ç —É—Ä–æ–≤–Ω—è <span id="objLevel">35</span></div>
    </div>

    <!-- SHOP / RIGHT PANEL -->
    <div class="right-panel" id="shopPanel">
      <div class="panel-duck-row">
        <div class="duck-av">ü¶Ü</div>
        <span class="panel-title">–ë—É—Å—Ç–µ—Ä—ã</span>
        <span style="margin-left:auto;opacity:.5;font-size:13px">‚ñ∂</span>
      </div>

      <div class="boosters-row">
        <div class="booster-item" onclick="activateBooster('quiz')">
          <div class="booster-btn blue">‚ùì</div>
        </div>
        <div class="booster-item">
          <div class="booster-btn red">üëë</div>
          <div class="booster-label gold">4.12 –§–ú</div>
        </div>
        <div class="booster-item" onclick="activateBooster('percent')">
          <div class="booster-btn teal">%</div>
          <div class="booster-label gold">12000 ü™ô</div>
        </div>
        <div class="booster-item" onclick="activateBooster('up')">
          <div class="booster-btn grn">‚¨ÜÔ∏è</div>
          <div class="booster-label">–±–µ—Å–ø–ª.</div>
        </div>
      </div>

      <div class="section-head">–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã</div>
      <div class="generators">

        <div class="gen-item" id="gen1" onclick="buyGenerator(1)">
          <div class="gen-icon y">üêì</div>
          <div class="gen-info">
            <div class="gen-name">–ü–µ—Ç—É—à–æ–∫ –Ω–∞ –ø–∞–ª–∫–µ</div>
            <div class="gen-cost">‚≠ê <span id="gen1Cost">15</span> ¬∑ +1/—Å–µ–∫</div>
          </div>
          <div class="gen-count" id="gen1Count">0</div>
        </div>

        <div class="gen-item" id="gen2" onclick="buyGenerator(2)">
          <div class="gen-icon y">üéÆ</div>
          <div class="gen-info">
            <div class="gen-name">–î–µ–Ω–¥–∏</div>
            <div class="gen-cost">‚≠ê <span id="gen2Cost">80</span> ¬∑ +5/—Å–µ–∫</div>
          </div>
          <div class="gen-count" id="gen2Count">0</div>
        </div>

        <div class="gen-item locked" id="gen3">
          <div class="gen-icon lk">‚ùì</div>
          <div class="gen-info"><div class="gen-name lk">???</div></div>
          <div class="gen-count lk">–ù—É–∂–µ–Ω<br>—É—Ä. 3</div>
        </div>

        <div class="gen-item locked" id="gen4">
          <div class="gen-icon lk">‚ùì</div>
          <div class="gen-info"><div class="gen-name lk">???</div></div>
          <div class="gen-count lk">–ù—É–∂–µ–Ω<br>—É—Ä. 5</div>
        </div>

      </div>
      <div class="shop-banner">üéâ –ü–†–û–ö–ê–ß–ê–ô –ù–û–°–¢–ê–õ–¨–ì–ò–Æ üéâ</div>
    </div>

  </div><!-- /content-area -->

  <!-- BOTTOM BANNER (desktop) -->
  <div class="bottom-banner">üéâ –ü—Ä–æ–∫–∞—á–∞–π –Ω–æ—Å—Ç–∞–ª—å–≥–∏—é üéâ</div>

  <!-- MOBILE NAV -->
  <nav class="mob-nav">
    <div class="mob-nav-inner">
      <button class="mob-tab active" id="tabClicker" onclick="switchTab('clicker')">
        <span class="ti">üëü</span>–ö–ª–∏–∫–µ—Ä
      </button>
      <button class="mob-tab" id="tabShop" onclick="switchTab('shop')">
        <span class="ti">üõçÔ∏è</span>–ú–∞–≥–∞–∑–∏–Ω
      </button>
      <button class="mob-tab" onclick="openModal()">
        <span class="ti">ü™ô</span>–ú–æ–Ω–µ—Ç—ã
      </button>
    </div>
  </nav>

</div><!-- /shell -->

<!-- MODAL -->
<div class="modal-overlay" id="modal">
  <div class="modal-box">
    <h2>üí∞ –ö—É–ø–∏—Ç—å –º–æ–Ω–µ—Ç—ã</h2>
    <p>–ü–æ–ø–æ–ª–Ω–∏ –±–∞–ª–∞–Ω—Å –∏ –ø–æ–ª—É—á–∏ √ó3 –ø–æ –∞–∫—Ü–∏–∏!</p>
    <div class="modal-big">ü™ô 100 –º–æ–Ω–µ—Ç</div>
    <div class="modal-btns">
      <button class="modal-btn confirm" onclick="buyCoins()">–ö—É–ø–∏—Ç—å!</button>
      <button class="modal-btn cancel"  onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button>
    </div>
  </div>
</div>

<script>
/* ‚îÄ‚îÄ STATE ‚îÄ‚îÄ */
let score = 2301, coins = 0, objLevel = 35;
let perSecond = 0, clickValue = 1;
let upgradeThreshold = 3000, boosterActive = null, freeUsed = false;

const gens = [
  { id:1, name:'–ü–µ—Ç—É—à–æ–∫', count:0, baseCost:15,   income:1  },
  { id:2, name:'–î–µ–Ω–¥–∏',   count:0, baseCost:80,   income:5  },
];

/* ‚îÄ‚îÄ FORMAT ‚îÄ‚îÄ */
function fmt(n) {
  if (n >= 1e9) return (n/1e9).toFixed(1)+' –º–ª—Ä–¥';
  if (n >= 1e6) return (n/1e6).toFixed(1)+' –º–ª–Ω';
  if (n >= 1000) return Math.floor(n).toLocaleString('ru');
  return Math.floor(n).toString();
}

/* ‚îÄ‚îÄ UPDATE UI ‚îÄ‚îÄ */
function ui() {
  document.getElementById('mainScore').textContent = fmt(score);
  document.getElementById('topScore').textContent  = '‚≠ê '+fmt(score+3);
  document.getElementById('coinCount').textContent = coins;
  document.getElementById('perSec').textContent    = '+'+perSecond;
  document.getElementById('objLevel').textContent  = objLevel;

  const prog = Math.min(100, Math.max(0, (score/upgradeThreshold)*100));
  document.getElementById('progressFill').style.width = prog+'%';
  const toNext = upgradeThreshold-score;
  document.getElementById('levelInfo').textContent = toNext > 0
    ? '–î–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ —É—Ä–æ–≤–Ω—è: '+fmt(toNext)+' ‚≠ê' : 'üî• –ì–æ—Ç–æ–≤–æ –∫ –∞–ø–≥—Ä–µ–π–¥—É!';
  document.getElementById('upgradeBtn').disabled = score < upgradeThreshold;

  gens.forEach(g => {
    const cost = Math.floor(g.baseCost * Math.pow(1.5, g.count));
    const costEl = document.getElementById('gen'+g.id+'Cost');
    const cntEl  = document.getElementById('gen'+g.id+'Count');
    const itEl   = document.getElementById('gen'+g.id);
    if (costEl) costEl.textContent = fmt(cost);
    if (cntEl)  cntEl.textContent  = g.count;
    if (itEl)   itEl.style.opacity = score >= cost ? '1' : '0.5';
  });

  const rank = Math.max(1, 1000 - Math.floor(score/100));
  document.getElementById('rankDisplay').textContent = '–í—ã –Ω–∞ '+rank+' –º–µ—Å—Ç–µ';
}

/* ‚îÄ‚îÄ CLICK ‚îÄ‚îÄ */
function doClick(cx, cy) {
  const val = clickValue * (boosterActive === 'percent' ? 2 : 1);
  score += val;
  const p = document.createElement('div');
  p.className = 'click-particle';
  p.textContent = '+'+val;
  p.style.cssText = `left:${cx}px;top:${cy-10}px`;
  document.body.appendChild(p);
  setTimeout(() => p.remove(), 850);
  ui();
}

const ring = document.getElementById('clickerRing');
ring.addEventListener('click', e => doClick(e.clientX, e.clientY));
ring.addEventListener('touchstart', e => {
  e.preventDefault();
  const t = e.touches[0];
  doClick(t.clientX, t.clientY);
}, { passive: false });

/* ‚îÄ‚îÄ UPGRADE ‚îÄ‚îÄ */
function upgrade() {
  if (score < upgradeThreshold) return;
  score -= upgradeThreshold;
  objLevel++;
  upgradeThreshold = Math.floor(upgradeThreshold * 1.8);
  clickValue++;
  if (objLevel >= 3) unlock(3,'üé∏','–ö–∞—Å—Å–µ—Ç–∞',  500, 20);
  if (objLevel >= 5) unlock(4,'üì∫','–¢–µ–ª–µ–≤–∏–∑–æ—Ä',2000, 50);
  flashRing();
  toast('üéâ –£—Ä–æ–≤–µ–Ω—å '+objLevel+'! –ö–ª–∏–∫ +'+clickValue+' ‚≠ê');
  ui();
}

function unlock(slot, icon, name, cost, income) {
  const el = document.getElementById('gen'+slot);
  if (!el || !el.classList.contains('locked')) return;
  el.classList.remove('locked');
  const bg = slot===3
    ? 'background:linear-gradient(135deg,#ff2200,#ff6600)'
    : 'background:linear-gradient(135deg,#0044ff,#00aaff)';
  el.innerHTML = `
    <div class="gen-icon" style="${bg};width:42px;height:42px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:24px;">${icon}</div>
    <div class="gen-info">
      <div class="gen-name">${name}</div>
      <div class="gen-cost">‚≠ê <span id="gen${slot}Cost">${cost}</span> ¬∑ +${income}/—Å–µ–∫</div>
    </div>
    <div class="gen-count" id="gen${slot}Count">0</div>`;
  gens.push({ id:slot, name, count:0, baseCost:cost, income });
  el.onclick = () => buyGenerator(slot);
}

/* ‚îÄ‚îÄ BUY GEN ‚îÄ‚îÄ */
function buyGenerator(id) {
  const g = gens.find(x => x.id === id);
  if (!g) return;
  const cost = Math.floor(g.baseCost * Math.pow(1.5, g.count));
  if (score < cost) { toast('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ ‚≠ê!'); return; }
  score -= cost; g.count++; perSecond += g.income;
  toast('‚úÖ '+g.name+' –∫—É–ø–ª–µ–Ω! +'+g.income+'/—Å–µ–∫'); ui();
}

/* ‚îÄ‚îÄ BOOSTERS ‚îÄ‚îÄ */
function activateBooster(type) {
  if (type==='quiz') {
    score += 50; toast('üé≤ –ë–æ–Ω—É—Å: +50 ‚≠ê');
  } else if (type==='percent') {
    if (coins < 12000) { toast('–ù—É–∂–Ω–æ 12 000 ü™ô!'); return; }
    coins -= 12000; boosterActive = 'percent';
    toast('üíπ –î–≤–æ–π–Ω–æ–π –∫–ª–∏–∫ –Ω–∞ 30 —Å–µ–∫!');
    setTimeout(() => { boosterActive=null; toast('–ë—É—Å—Ç–µ—Ä –∑–∞–∫–æ–Ω—á–∏–ª—Å—è'); }, 30000);
  } else if (type==='up') {
    if (freeUsed) { toast('–£–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω —Å–µ–≥–æ–¥–Ω—è!'); return; }
    freeUsed = true; score += 200; toast('‚¨ÜÔ∏è –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –±–æ–Ω—É—Å: +200 ‚≠ê!');
  }
  ui();
}

/* ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ */
function openModal()  { document.getElementById('modal').classList.add('active'); }
function closeModal() { document.getElementById('modal').classList.remove('active'); }
function buyCoins() {
  coins += 300; closeModal();
  toast('ü™ô +300 –º–æ–Ω–µ—Ç (–∞–∫—Ü–∏—è √ó3)!'); ui();
}

/* ‚îÄ‚îÄ TABS (mobile) ‚îÄ‚îÄ */
function switchTab(tab) {
  const cc = document.getElementById('clickerCol');
  const sp = document.getElementById('shopPanel');
  const tc = document.getElementById('tabClicker');
  const ts = document.getElementById('tabShop');
  if (tab==='clicker') {
    cc.classList.add('mob-active');   sp.classList.remove('mob-active');
    tc.classList.add('active');       ts.classList.remove('active');
  } else {
    sp.classList.add('mob-active');   cc.classList.remove('mob-active');
    ts.classList.add('active');       tc.classList.remove('active');
  }
}

/* ‚îÄ‚îÄ FLASH RING ‚îÄ‚îÄ */
function flashRing() {
  ring.style.transform='scale(1.07)'; ring.style.filter='brightness(1.4)';
  setTimeout(()=>{ ring.style.transform=''; ring.style.filter=''; }, 200);
}

/* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
function toast(msg) {
  const t = document.createElement('div');
  t.style.cssText=`
    position:fixed;bottom:80px;left:50%;transform:translateX(-50%);
    background:rgba(10,0,30,.92);color:var(--yellow);
    padding:9px 18px;border-radius:12px;white-space:nowrap;
    font-family:'Russo One',sans-serif;font-size:13px;
    z-index:9998;border:2px solid rgba(255,215,0,.45);
    animation:flyup .35s ease;
  `;
  t.textContent=msg;
  document.body.appendChild(t);
  setTimeout(()=>t.remove(),2400);
}

/* ‚îÄ‚îÄ PASSIVE INCOME ‚îÄ‚îÄ */
setInterval(()=>{ if(perSecond>0){ score+=perSecond; ui(); } }, 1000);

ui();
</script>
</body>
</html>
